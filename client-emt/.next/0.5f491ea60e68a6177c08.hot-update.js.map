{"version":3,"file":"0.5f491ea60e68a6177c08.hot-update.js","sources":["webpack:///components/topHeader/ChangeAvatarModal.js"],"sourcesContent":["import { Modal, Button, Upload, Icon, message, Spin } from 'antd';\nimport { withApollo, ApolloConsumer } from 'react-apollo';\nimport { Image } from 'cloudinary-react';\nimport { updateAvatar as UPDATE_AVATAR_MUTATION } from '../../graphql/mutations.gql';\nimport { getCurrentUser as GET_CURRENT_USER_QUERY } from '../../graphql/queries.gql';\nimport { CLOUD_NAME } from '../../constants';\nimport stylesheet from 'styles/updateAvatar.less';\n\nclass ChangeAvatarModal extends React.Component {\n  state = {\n    visible: false,\n    loading: false,\n  };\n  beforeUpload = file => {\n    const isJPG = file.type === 'image/jpeg' || 'image/png';\n    if (!isJPG) {\n      message.error('You can only upload JPG or PNG file!');\n      return false;\n    }\n    const isLt2M = file.size / 1024 / 1024 < 2;\n    if (!isLt2M) {\n      message.error('Image must smaller than 2MB!');\n      return false;\n    }\n    this.startUpload(file);\n    return false;\n  };\n  startUpload = async file => {\n    this.setState({ loading: true });\n\n    this.props.client\n      .mutate({\n        mutation: UPDATE_AVATAR_MUTATION,\n        variables: {\n          input: {\n            avatar: file,\n          },\n        },\n      })\n      .then(data => {\n        const { avatarUrl } = data.data.updateAvatar;\n\n        const { currentUser } = this.props.client.readQuery({\n          query: GET_CURRENT_USER_QUERY,\n        });\n        currentUser.avatar = avatarUrl;\n        this.props.client.writeQuery({\n          query: GET_CURRENT_USER_QUERY,\n          data: { currentUser },\n        });\n\n        this.setState({\n          loading: false,\n        });\n      });\n  };\n  showModal = () => {\n    this.setState({\n      visible: true,\n    });\n  };\n  handleOk = e => {\n    console.log(e);\n    this.setState({\n      visible: false,\n    });\n  };\n  handleCancel = e => {\n    console.log(e);\n    this.setState({\n      visible: false,\n    });\n  };\n  render() {\n    return (\n      <React.Fragment>\n        <a onClick={this.showModal} className=\"change-avatar-link\">\n          Change Avatar\n        </a>\n        <Modal\n          title=\"Change Picture\"\n          visible={this.state.visible}\n          footer={null}\n          onCancel={this.handleCancel}\n        >\n          <ApolloConsumer>\n            {client => {\n              const data = client.readQuery({\n                query: GET_CURRENT_USER_QUERY,\n              });\n              const { currentUser } = data;\n              return (\n                <div className=\"upload-avatar-layout\">\n                  <Upload\n                    name=\"avatar\"\n                    listType=\"picture-card\"\n                    className=\"avatar-uploader\"\n                    showUploadList={false}\n                    beforeUpload={this.beforeUpload}\n                  >\n                    <style dangerouslySetInnerHTML={{ __html: stylesheet }} />\n                    <Spin\n                      tip=\"Uploading...\"\n                      spinning={this.state.loading}\n                      style={{ right: '0%' }}\n                      indicator={<Icon type=\"loading\" style={{ fontSize: 24 }} spin />}\n                    >\n                      <Image\n                        cloudName={CLOUD_NAME}\n                        publicId={currentUser.avatar}\n                        width=\"300\"\n                        crop=\"scale\"\n                        style={{ margin: 'auto' }}\n                      />\n                    </Spin>\n                  </Upload>\n                </div>\n              );\n            }}\n          </ApolloConsumer>\n        </Modal>\n      </React.Fragment>\n    );\n  }\n}\n\nexport default withApollo(ChangeAvatarModal);\n\n\n\n// WEBPACK FOOTER //\n// components/topHeader/ChangeAvatarModal.js"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAnHA;AAsHA;;;;;A","sourceRoot":""}